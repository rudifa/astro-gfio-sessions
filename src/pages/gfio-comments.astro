---
import ShoelaceLayout from '../layouts/ShoelaceLayout.astro';
import Card from '../components/Card.astro';

import {
  fetchAllIssuesWithComments,
  getGithubAccessToken,
} from '../util/fetchgfiocomments.js';

const owner = 'gongfudev';
const repo = 'sessions';
const token = getGithubAccessToken();

let commentsData;

// Define an async function to fetch the comments data
async function fetchComments() {
  commentsData = await fetchAllIssuesWithComments(owner, token, repo);
  commentsData.reverse();
}

// Call the function
await fetchComments();
console.log('fetched commentsData: length=', commentsData.length);
---

<ShoelaceLayout title='gfio-comments'>
  <h1>Hello gfio!</h1>

  <div class='gfio-comments'>
    {
      commentsData.map((session) => (
        <Card
          title={session.title}
          description={session.body}
          author={session.author}
          createdAt={session.createdAt}
          comments={session.comments.nodes}
        />
      ))
    }
  </div>
</ShoelaceLayout>

<script></script>
